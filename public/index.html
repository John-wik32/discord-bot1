<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Discord Media Poster</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  background:linear-gradient(135deg,#667eea,#764ba2);
}
.tabs {
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:20px;
}
.tab-btn {
  padding:10px 20px;
  border:none;
  border-radius:6px;
  background:#ffffff55;
  color:white;
  cursor:pointer;
}
.tab-btn.active {
  background:white;
  color:#667eea;
}
.container {
  max-width:800px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:10px;
}
.page { display:none; }
.page.active { display:block; }
.message {
  padding:10px;
  margin-bottom:10px;
  display:none;
}
.message.show { display:block; }
.message.error { background:#f8d7da; }
.message.success { background:#d4edda; }
.file-item {
  background:#eee;
  padding:6px;
  margin:5px 0;
  display:flex;
  justify-content:space-between;
}
</style>
</head>

<body>

<div class="tabs">
  <button class="tab-btn active" data-page="create">Create</button>
  <button class="tab-btn" data-page="schedules">Schedules</button>
</div>

<div class="container">

<div id="create" class="page active">
  <div id="message" class="message"></div>

  <label>Password</label>
  <input type="password" id="password">

  <label>Channel</label>
  <select id="channel">
    <option value="">Enter password first</option>
  </select>

  <label>Files</label>
  <input type="file" id="fileInput" multiple>

  <div id="fileList"></div>

  <button id="sendNowBtn">Send Now</button>
</div>

<div id="schedules" class="page">
  <p>No schedules yet</p>
</div>

</div>

<script>
const API_URL = window.location.origin;
let selectedFiles = [];

document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.getElementById(btn.dataset.page).classList.add("active");
    btn.classList.add("active");
  });
});

function showMessage(text, type) {
  const msg = document.getElementById("message");
  msg.textContent = text;
  msg.className = "message show " + type;
}

document.getElementById("password").addEventListener("change", loadChannels);

async function loadChannels() {
  const pwd = document.getElementById("password").value;
  if (!pwd) return;

  const res = await fetch(API_URL + "/api/channels", {
    headers: { "x-dashboard-pwd": pwd }
  });

  if (!res.ok) {
    showMessage("Invalid password", "error");
    return;
  }

  const channels = await res.json();
  const select = document.getElementById("channel");
  select.innerHTML = "<option value=''>Select channel</option>";
  channels.forEach(c => {
    const o = document.createElement("option");
    o.value = c.id;
    o.textContent = c.guild + " - " + c.name;
    select.appendChild(o);
  });
}

document.getElementById("fileInput").addEventListener("change", e => {
  selectedFiles = Array.from(e.target.files);
  const list = document.getElementById("fileList");
  list.innerHTML = "";
  selectedFiles.forEach((f,i) => {
    const div = document.createElement("div");
    div.className = "file-item";
    div.innerHTML = `<span>${f.name}</span><button onclick="removeFile(${i})">X</button>`;
    list.appendChild(div);
  });
});

function removeFile(i) {
  selectedFiles.splice(i,1);
  document.getElementById("fileInput").dispatchEvent(new Event("change"));
}

document.getElementById("sendNowBtn").addEventListener("click", async () => {
  const pwd = document.getElementById("password").value;
  const channelId = document.getElementById("channel").value;

  if (!pwd || !channelId || selectedFiles.length === 0) {
    showMessage("Missing fields", "error");
    return;
  }

  const formData = new FormData();
  selectedFiles.forEach(f => formData.append("files", f));

  const res = await fetch(API_URL + "/api/upload", {
    method: "POST",
    headers: { "x-dashboard-pwd": pwd },
    body: formData
  });

  if (!res.ok) {
    showMessage("Upload failed", "error");
    return;
  }

  showMessage("Files uploaded successfully", "success");
});
</script>

</body>
</html>
