<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Video Sender Dashboard</title>

<meta http-equiv="Content-Security-Policy"
content="
default-src 'self';
script-src 'self' 'unsafe-inline' 'unsafe-eval';
style-src 'self' 'unsafe-inline';
connect-src 'self';
">

<style>
body { background:#0b1220; color:white; font-family:Arial; padding:20px }
button { padding:8px; margin:5px }
.panel { display:none }
.panel.active { display:block }
input { padding:6px }
</style>
</head>

<body>

<h1>ðŸŽ¬ Discord Media Bot</h1>

<div id="login" class="panel active">
  <input id="pass" type="password" placeholder="Dashboard password">
  <button onclick="login()">Login</button>
  <p id="msg"></p>
</div>

<div id="dash" class="panel">
  <button onclick="show('send')">Send / Schedule</button>
  <button onclick="show('view')">View Schedules</button>

  <div id="send" class="panel active">
    <h3>Upload Media</h3>
    <input id="title" placeholder="Title"><br><br>
    <input id="minutes" type="number" placeholder="Minutes from now"><br><br>
    <input id="files" type="file" multiple><br><br>
    <button onclick="upload()">Submit</button>
    <pre id="result"></pre>
  </div>

  <div id="view" class="panel">
    <h3>Scheduled</h3>
    <pre id="list"></pre>
  </div>
</div>

<script>
function login() {
  fetch("/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ password: pass.value })
  }).then(r=>r.json()).then(d=>{
    if(d.success){
      login.classList.remove("active");
      dash.classList.add("active");
    } else msg.innerText="Wrong password";
  });
}

function show(id){
  document.querySelectorAll(".panel").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function upload(){
  const fd = new FormData();
  fd.append("title", title.value);
  fd.append("minutes", minutes.value);
  for(const f of files.files) fd.append("files", f);

  fetch("/upload",{ method:"POST", body:fd })
    .then(r=>r.json())
    .then(d=> result.innerText = JSON.stringify(d,null,2));
}

function loadSchedules(){
  fetch("/schedules")
    .then(r=>r.json())
    .then(d=> list.innerText = JSON.stringify(d,null,2));
}

setInterval(loadSchedules, 5000);
</script>

</body>
</html>
